#src/Resources/config/services.yml
parameters:
  #Request bridge
  teknoo.reactphp_bridge.request_bridge.class: 'Teknoo\ReactPHPBundle\Bridge\RequestBridge'
  teknoo.reactphp_bridge.request_listener.class: 'Teknoo\ReactPHPBundle\Bridge\RequestListener'
  teknoo.reactphp_bridge.request_builder.class: 'Teknoo\ReactPHPBundle\Bridge\RequestBuilder'
  teknoo.reactphp_bridge.request_builder.arguments: []

  #Request parser
  teknoo.reactphp_bridge.request_parser.header.class: 'Teknoo\ReactPHPBundle\Bridge\Parser\HeaderRequestParser'
  teknoo.reactphp_bridge.request_parser.json.class: 'Teknoo\ReactPHPBundle\Bridge\Parser\JsonRequestParser'
  teknoo.reactphp_bridge.request_parser.multipart.class: 'Teknoo\ReactPHPBundle\Bridge\Parser\MultipartRequestParser'
  teknoo.reactphp_bridge.request_parser.query.class: 'Teknoo\ReactPHPBundle\Bridge\Parser\QueryRequestParser'
  teknoo.reactphp_bridge.request_parser.server.class: 'Teknoo\ReactPHPBundle\Bridge\Parser\ServerRequestParser'
  teknoo.reactphp_bridge.request_parser.url_encoded.class: 'Teknoo\ReactPHPBundle\Bridge\Parser\UrlEncodedRequestParser'

  #Command controller
  teknoo.reactphp_bridge.command.class: 'Teknoo\ReactPHPBundle\Command\ReactPHPCommand'

  #Vendors
  teknoo.reactphp_bridge.vendor.loop.class: 'React\EventLoop\LoopInterface'

  #services
  teknoo.reactphp_bridge.service.dates.class: 'Teknoo\ReactPHPBundle\Service\DatesService'
  teknoo.reactphp_bridge.logger.std_logger.class: 'Teknoo\ReactPHPBundle\Logger\StdLogger'

services:
  #Request bridge
  teknoo.reactphp_bridge.request_builder:
    class: "%teknoo.reactphp_bridge.request_builder.class%"
    arguments:
      - "%teknoo.reactphp_bridge.request_builder.arguments%"

  teknoo.reactphp_bridge.request_bridge:
    class: "%teknoo.reactphp_bridge.request_bridge.class%"
    arguments:
      - "@kernel"
      - "@teknoo.reactphp_bridge.service.dates"
      - "@teknoo.reactphp_bridge.request_builder"
    calls:
      - ['setLogger', ["@teknoo.reactphp_bridge.logger.std_logger"]]

  #Request parser
  teknoo.reactphp_bridge.request_listener:
    class: "%teknoo.reactphp_bridge.request_listener.class%"
    arguments:
      - "@teknoo.reactphp_bridge.request_bridge"

  teknoo.reactphp_bridge.request_parser.header:
    class: "%teknoo.reactphp_bridge.request_parser.header.class%"
    tags:
      - { name: 'reactphp_bridge.request_parser' }

  teknoo.reactphp_bridge.request_parser.json:
    class: "%teknoo.reactphp_bridge.request_parser.json.class%"
    tags:
      - { name: 'reactphp_bridge.request_parser' }

  teknoo.reactphp_bridge.request_parser.multipart:
    class: "%teknoo.reactphp_bridge.request_parser.multipart.class%"
    tags:
      - { name: 'reactphp_bridge.request_parser' }

  teknoo.reactphp_bridge.request_parser.query:
    class: "%teknoo.reactphp_bridge.request_parser.query.class%"
    tags:
      - { name: 'reactphp_bridge.request_parser' }

  teknoo.reactphp_bridge.request_parser.server:
    class: "%teknoo.reactphp_bridge.request_parser.server.class%"
    tags:
      - { name: 'reactphp_bridge.request_parser' }

  teknoo.reactphp_bridge.request_parser.url_encoded:
    class: "%teknoo.reactphp_bridge.request_parser.url_encoded.class%"
    tags:
      - { name: 'reactphp_bridge.request_parser' }

  #Command controller
  teknoo.reactphp_bridge.command:
    class: "%teknoo.reactphp_bridge.command.class%"
    arguments:
      - "@teknoo.reactphp_bridge.request_listener"
      - "@teknoo.reactphp_bridge.vendor.loop"
      - "@teknoo.reactphp_bridge.logger.std_logger"
    tags:
      - { name: console.command }

  #Vendors
  teknoo.reactphp_bridge.vendor.loop:
    class: "%teknoo.reactphp_bridge.vendor.loop.class%"
    factory: ['React\EventLoop\Factory', 'create']

  #services
  teknoo.reactphp_bridge.service.dates:
    class: "%teknoo.reactphp_bridge.service.dates.class%"

  teknoo.reactphp_bridge.logger.std_logger:
    class: "%teknoo.reactphp_bridge.logger.std_logger.class%"
